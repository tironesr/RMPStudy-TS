<!DOCTYPE html>
<html>
  <h1> tester </h1>
  <body>
    hi
    <button id="stopButton">Stop Timer</button>
  </body>
  <script src="https://unpkg.com/url-search-params"></script>
  <script>
const urlParams = new URLSearchParams(window.location.search);
const PID = urlParams.get('PID');
console.log(PID);
  </script>
<script>
let startTime;
let time_spent;
let timerId;

function startTimer() {
  startTime = performance.now();
  timerId = setInterval(() => {
    // You can use this interval to update a display if needed
  }, 100); // Adjust interval as needed
}

function stopTimer() {
  clearInterval(timerId);
  time_spent = (performance.now() - startTime) / 1000; // Convert to seconds
  console.log("Time spent:", time_spent, "seconds");

  // Send the POST request
  var testdata = `"rt","stimulus","response","trial_type","trial_index","time_elapsed","time_spent","participant_id","PID","success"\n` +
                `"null","null","null","null","null","null","${time_spent}","null","${PID}","null"`;
  fetch("https://pipe.jspsych.org/api/data/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Accept: "*/*",
    },
    body: JSON.stringify({
      experimentID: "B2ZcxsecKMWu",
      filename: "test11.csv",
      data: testdata
    }),
  });
}

const stopButton = document.getElementById('stopButton');
stopButton.addEventListener('click', stopTimer);

// Start timer when page loads
window.onload = startTimer;
</script>
</html>
