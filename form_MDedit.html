<style>
h1{text-align: center;}
h3{text-align: center;}
div{text-align: center;}
footer{text-align: center;position: absolute; bottom: 0; left: 0; right: 0; font-size:16px;}
</style>
<html>
<!--load packages-->
<script src="https://unpkg.com/url-search-params"></script>
<script src="https://unpkg.com/jspsych@7.0.0"></script>
<link href="https://unpkg.com/jspsych@7.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
<script src="https://unpkg.com/@jspsych-contrib/plugin-pipe@0.3"></script>
<script src="https://unpkg.com/@jspsych/plugin-survey-html-form@2.0.0"></script>
<script src="https://unpkg.com/@jspsych/plugin-initialize-camera@2.0.0"></script>
<script src="https://unpkg.com/@jspsych/plugin-mirror-camera@2.0.0"></script>
<script src="https://unpkg.com/@jspsych/plugin-external-html@1.1.3"></script>
<script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>



<script>
// initialize jsPsych
const jsPsych = initJsPsych({
  on_close: function(){
    var data = jsPsych.data.get().json();
    save_data_to_server(save_data_trial);
  }
});

// get PID from URL parameters
function getUrlParameter(name) {
   const urlParams = new URLSearchParams(window.location.search);
   return urlParams.get(name);
}

const urlParams = new URLSearchParams(window.location.search);
const PID = urlParams.get('PID');
console.log(PID)

// add PID to data object
jsPsych.data.addProperties({participant_id: PID});

// capture how much time a user spends on page
// records start time when the page loads
let startTime;

window.onload = function() {
    startTime = new Date().getTime();
}; 

// records end time when the page unloads
window.onbeforeunload = function() {
    const endTime = new Date().getTime();
    const timeSpent = endTime - startTime; // Time in milliseconds

    // add time spent to data object
    console.log(`User spent ${timeSpent / 1000} seconds on the page.`);
    jsPsych.data.addProperties({time_spent: timeSpent});
    
};   


// create a an instruction trial using the jsPsychInstructions plugin
const trial = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Welcome to the experiment.",
    trial_duration: 1000
}

const timeline = [trial];

// experiment ID - research how to save it in another JS and import it
var exprimentID = "B2ZcxsecKMWu";

// Generate a random subject ID.
const subjectID = jsPsych.randomization.randomID(10);
console.log({subjectID});

var save_data_trial = {
  type: jsPsychPipe,
  action: "save",
  experiment_id: exprimentID,
  filename: `${subjectID}.csv`,
  data_string: function () {
    return jsPsych.data.get().csv() 
  }
};

console.log(save_data_trial);
	
//push saving data to timeline
timeline.push(save_data_trial);

// run the experiment
jsPsych.run(timeline);
	
</script>

	<h3 style ="font-family:verdana">
Before connecting to the live call, you and your partner will be shown each other's responses.
</h3>
<form>
<label style = "font-family:verdana" for="name">Please input the name you would like your partner to address you by. For example, this could be your given name, a nickname, or your initials.</label><br>
<input type = "text" id = "name"><br><br>
<label style = "font-family:verdana" for="age">How old are you?</label><br>
<input type = "text" id = "age"><br><br><br>
<label style = "font-family:verdana" for="age">Please write a short letter to your partner with any information about yourself that you feel comfortable sharing.<br> 
<br> For example, you might include information about your hobbies, your career, or your family.<br>
<br> You will be given <strong>three</strong> minutes to write, after which the "Submit" button will appear.<br></label>
<br><textarea name="paragraph_text" cols="90" rows="15"></textarea><br><br>
</form>
   <div> 
   <p style ="font-family:verdana">
  When you have completed the questions and are ready to view your partner's responses, please click "Submit" below.
   </p>
     <button style="font-size:16px;font-family:verdana;display: none" id = "submit">
        <a href="https://rascl.berkeley.edu/RSVCCode/IncompleteBio%3fauth_key=07123e1f482356c415f684407a3b8723e10b2cbbc0b8fcd6282c49d37c9c1abc.html">Submit</a>
  </button>
   </div>   
<footer>
  Copyright (c) 2021 Relationships and Social Cognition Lab at UC Berkeley
</footer>

    <script src="main.js"></script>


</html>
